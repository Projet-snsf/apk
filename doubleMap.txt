
var mapType = null
const coords = [
    [14.6928, -17.4467],
    [14.7, -17.45],
    [14.705, -17.44]
];

// Fonction générique pour ajouter une polyline
  function addPolyline(mapInstance, coords, type = 'leaflet', options = {}) {
    if (type === 'leaflet') {
      leafletPolyline = L.polyline(coords, {
        color: options.color || 'blue',
        weight: options.weight || 4,
        opacity: options.opacity || 0.7,
      }).addTo(mapInstance);
      mapInstance.fitBounds(leafletPolyline.getBounds());
    }

    if (type === 'mapbox') {
      const id = options.id || `line-${Math.random().toString(36).substr(2, 9)}`;
      const geojsonCoords = coords.map(c => [c[1], c[0]]);

      if (mapInstance.getSource(id)) {
        mapInstance.removeLayer(id);
        mapInstance.removeSource(id);
      }

      mapInstance.addSource(id, {
        type: 'geojson',
        data: {
          type: 'Feature',
          geometry: {
            type: 'LineString',
            coordinates: geojsonCoords
          }
        }
      });

      mapInstance.addLayer({
        id: id,
        type: 'line',
        source: id,
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': options.color || '#3887be',
          'line-width': options.weight || 4,
          'line-opacity': options.opacity || 0.8
        }
      });

      mapboxPolylineId = id;
    }
  }

  // Fonction pour afficher/masquer la polyline
  function togglePolyline() {
    if (mapType === 'leaflet') {
      if (map.hasLayer(leafletPolyline)){map.removeLayer(leafletPolyline)}else{leafletPolyline.addTo(map)}
    }

    if (mapType === 'mapbox') {
      if (mapboxPolylineId) {mapbo.setLayoutProperty(mapboxPolylineId, 'visibility', 'visible');
      } else  {mapbo.setLayoutProperty(mapboxPolylineId, 'visibility', 'none')}
    }
  }

  // Fonction pour supprimer la polyline
  function removePolyline() {
    if (mapType === 'leaflet' && leafletPolyline) {
      map.removeLayer(leafletPolyline);
      leafletPolyline = null;
    }

    if (mapType === 'mapbox' && mapboxPolylineId) {
      mapbo.removeLayer(mapboxPolylineId);
      mapbo.removeSource(mapboxPolylineId);
      mapboxPolylineId = null;
    }
  }

  // Ajouter la polyline initialement
   addPolyline(map, coords, 'leaflet', { color: 'red' });
   mapbo.on('load', () => {addPolyline(mapbo, coords, 'mapbox', { color: '#00aa00', weight: 5 });
  });

